---
title: "Data Wrangling Final Project"
author: "Brianna Eskin"
date: "4/14/2020"
output: pdf_document
---
```{r packages, echo=FALSE}
source("C:\\Users\\Brianna\\Documents\\R\\597\\Final Project\\DataWranglingProjectSpring2020\\functions.r")
```

## Introduction

Jeopardy! is a game show in which contestants choose clues worth varying dollar amounts from predetermined general knowledge categories in the form of an answer and provide their answers in the form of a question. The first iteration of the show premiered on March 30, 1964 and was hosted by Art Fleming. The show underwent a few rounds of syndication before the current version of the game hosted by Alex Trebek premiered on September 10, 1984. The current syndicated version of the game, which is what this report will focus on, has seen some slight changes to the rules over the past 36 seasons, but the general strucutre has remained largely the same. In the first two rounds, Jeopardy and Double Jeopardy, contestants choose one of five clues with varying diffciulty and worth different dollar amounts from one of six categories. The clues are presented in the form of an answer and once the question is read, a contestant may buzz in and provide their response in the form of a question. If the contestant is correct, they earn the amount of money the clue was worth. If they are incorrect, they lose that amount. In each round, there are also Daily Doubles behind random clues, which allow the contestant who uncovered it to bet any amount they wish, up to their current amount earned. Then in the final round, Final Jeopardy, the contestants see the category and before the clue is read, wager some or all of their money that they then either gain or lose depending on if they respond correctly. At the end of the game, the contestant with the highest amount of money is crowned the victor, and returns the next day as the Champion until they lose.

For my project, I will be wrangling data pertaining to the all time highest Jeopardy winners, as listed on https://www.jeopardy.com/contestant-zone/hall-of-fame. As of April 14, 2020 these contestants are:
1. Brad Rutter
2. Ken Jennings
3. James Holzhauer
4. David Madden
5. Larissa Kelly
6. Matt Jackson
7. Jason Zuffranieri
8. Roger Craig
9. Colby Burnett
10. Julia Collins

<Add here the different topics you end up discussing>

I am interested in Jeopardy! data because Jeopardy! is my all time favorite television program. There are many different aspects that go into the game, including contestant personalities, the trivia which allows viewers to easily play along at home, wagering strategy, and reflexes on the buzzer - all of which make the game exciting to watch. Also, because of these different layers of the game, there is a lot of different data that can be analyzed. 

## Data Sources

For my project, I will be scraping data from the J-Archive (https://j-archive.com/), which is a fan run archive of most of the games from the Alex Trebek era of Jeopardy!. For all of the contestants I am analyzing, I will pull data from their individual game pages and for each individual game page, I will scrape the game scores page. For example, the season 36 premiere was also the 7th game won by Jason Zuffranieri, so I will scrape from these sites: http://www.j-archive.com/showgame.php?game_id=6410 and http://www.j-archive.com/showscores.php?game_id=6410. However, because he played in 20 games, I wil scrape from 20 sets of sites for game data pertaining to him. I will do the same for the other contestants
<Add here other sites I end up scrpaing from>

## Data Scraping

My main data frame was constructed starting with an empty data frame and a data frame consisting of the full names of contestants, player ids to link them to different pages on the J-Archive!, and the Team they played on during the Jeopardy All-Stars Tournament that aired in 2019. A contestant may appear multiple times if more than one player page was required to pull all of the games they played in.

```{r contestants, echo = FALSE}
contestants <- data.frame(
  Contestants = c("Brad Rutter", "Brad Rutter", "Brad Rutter", "Ken Jennings", "Ken Jennings", "James Holzhauer", "David Madden", "Larissa Kelly", "Larissa Kelly", "Matt Jackson", "Jason Zuffranieri", "Roger Craig", "Roger Craig", "Colby Burnett", "Colby Burnett", "Julia Collins"), playerIds = c(278, 622, 12536, 661, 12547, 12983, 1963, 4956, 12539, 10266, 12824, 6976, 12550, 8057, 12537, 9517), AllStarsTeam = c("Team Brad", "Team Brad", "Team Brad", "Team Ken", "Team Ken", "No Team", "Team Brad", "Team Brad", "Team Brad", "Team Ken", "No Team", "Team Austin", "Team Austin", "Team Colby", "Team Colby", "Team Julia"), stringsAsFactors = FALSE
)
contestant_names <- c("Brad Rutter", "Ken Jennings", "James Holzhauer", "David Madden", "Larissa Kelly", "Matt Jackson", "Jason Zuffranieri", "Roger Craig", "Colby Burnett", "Julia Collins")
contestants
```

```{r dataScraping, echo = FALSE, warning = FALSE}
game_level_df <- data.frame(Contestant = character(),
                            GameIdForUrl = integer(),
                            GameId = integer(),
                            Date = character(),
                            FinalScore = integer(),
                            Outcome = character(),
                            GameFormat = character(), 
                            TournamentName = character(),
                            stringsAsFactors = FALSE
)

for (row in 1:nrow(contestants)) {
  contestant <- contestants[row, 1]
  player_id <- contestants[row, 2]
  allStarTeam <- contestants[row, 3]
  gameIdsForUrl <- getGameIdsForUrl(player_id)
  for (row in 1:nrow(gameIdsForUrl)) {
    gameIdForUrl <- gameIdsForUrl[row, 1]
    rowForGameLevelTable <- getRowForGameLevelTable(contestant, gameIdForUrl, allStarTeam)
    if(rowForGameLevelTable != "Don't include"){
      game_level_df <- rbind(game_level_df, rowForGameLevelTable)
    }
  }
}
game_level_df <- game_level_df %>%
  distinct()
game_level_df$Outcome <- as.character(game_level_df$Outcome)
```

Once I created this table, I iterated through the rows of the contestant table. Using the player id, I scraped the player pages on J-Archive to find the different game ids pertaining to their specific games. To do this, I extracted all of the "a" nodes and pulled the game id from the href tags using regular expressions, by searching for digits. This was difficult because there are two types of "game ids". The first the game's position in the sequence of Jeopardy games, which is what is included in my final table and used for the purpose of arranging the table by date game is played. The other game id, which is what I am interested in for this purpose, is the id used in the url, which is probably the sequence of when the game was added. The latter wasn't easily grabbed by CSS selector, so I was forced to check the class in the tag.

The once I had the list of game ids, I iterated through that list to scrape the individual game level and score sites, similar to those mentioned in the "Data Sources" paragraph. From these sites, I was able to extract notes about the game (i.e. was it a tournament game or regular season game), the game id (this time, talking about the episode number), the date that game aired, the final score, the outcome (did the player win or lose, or in the event of a tournament, did they automatically advance, or rely on a wildcard spot). I then added a row to my data frame consisting of this information, along with the contestant's name.

Most of this data was compiled scraping various nodes of the two sites. There were some pain points. First, there were some games that were split into multiple episodes. In particular, this was done during the IBM Watson exhibition matches in 2011, and the first round of the Jeopardy All Star Games competition in 2019. Because I am only interested in final scores, I had to exclude these games by check if the game comments mentioned that the episode was the Jeopardy Round only. Second, the Final Jeopardy table on the game site was incosistent between episodes. This was most often the case during finals of Tournaments, where the winner is determined by a two day total. So I needed to check how many columns were in table and add an Outcome column if it wasn't there, and noting that the game is an Accumulated game. The last issue I had was with the All Star Games - the Final Jeopardy table name was the name of the team, so I had to add an input to my function with the All Star team and assign the game to a contestant if the name in the table was either their name, or the name of their All Star Team. Below is what the table looks like for the contestant Roger Craig, who competed in Regular Season play, the Tournament of Champions, the Battle of the Decades, and the All Star games:

```{r dataScrapingOutput, echo = FALSE}
game_level_df %>%
  filter(Contestant == "Roger Craig") %>%
  arrange(desc(GameId))
```

<Now talk about how I separated regular season winnings from tournament winnings, and output bar graph>

```{r AllTimeWinnings, echo = FALSE}
tournament_winnings_df <- data.frame(
  Contestant = character(),
  TournamentName = character(),
  Outcome = character(),
  Winnings = integer(),
  stringsAsFactors = FALSE
)
game_level_df_tournament <- game_level_df %>%
  filter(TournamentName != "Regular Season") %>%
  select(Contestant, TournamentName) %>%
  distinct()
for (row in 1:nrow(game_level_df_tournament)) {
  contestant <- game_level_df_tournament[row, 1]
  tournamentName <- game_level_df_tournament[row, 2]
  rowForTournamentWinningTable <- getRowForTournamentWinningsTable(contestant, tournamentName)
  tournament_winnings_df <- rbind(tournament_winnings_df, rowForTournamentWinningTable)
}
game_level_df_regular_season <- game_level_df %>%
  filter(TournamentName == "Regular Season") %>%
  select(Contestant, GameId, TournamentName, FinalScore, Outcome)
for (contestant in contestant_names) {
    if(contestant != "Brad Rutter") {
    game_level_df_regular_season_filtered <- game_level_df_regular_season %>%
      filter(Contestant == contestant) %>%
      filter(GameId == max(GameId))
    gameId <- game_level_df_regular_season_filtered$GameId
    winnings <- str_extract(game_level_df_regular_season_filtered$Outcome,"(?<=:\\s).*") %>%
      str_replace_all("\\$|,", "") %>%
      as.numeric()
    print(contestant)
    print(winnings)
    game_level_df_regular_season[game_level_df_regular_season$GameId == gameId, "FinalScore"] <- winnings
  }
}
```

